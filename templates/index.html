<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description" content="Spotify downloader for downloading Spotify songs via a link">
    <meta name="msapplication-TileImage" content="https://tobiasrick.de/SpotifyDownloader.png">
    <meta property="og:site_name" content="Spotify Downloader">
    <meta property="og:title" content="Spotify Downloader">
    <meta property="og:description" content="Spotify downloader for downloading Spotify songs via a link">
    <meta property="og:image" itemprop="image" content="https://tobiasrick.de/SpotifyDownloader.png">
    <meta property="og:type" content="website" />
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="300">
    <meta property="og:image:height" content="300">
    <meta property="og:url" content="https://sd.codemagie.xyz/">
    <link rel="icon" href="https://tobiasrick.de/SpotifyDownloader.png" type="image/png">

    <title>Spotify Downloader</title>
    <!-- Include Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8J4JDM8GTP"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-8J4JDM8GTP');
    </script>

    <script>
        !function (Gleap, t, i) {
            if (!(Gleap = window.Gleap = window.Gleap || []).invoked) {
                for (window.GleapActions = [], Gleap.invoked = !0, Gleap.methods = ["identify", "setEnvironment", "setTags", "attachCustomData", "setCustomData", "removeCustomData", "clearCustomData", "registerCustomAction", "trackEvent", "log", "preFillForm", "showSurvey", "sendSilentCrashReport", "startFeedbackFlow", "startBot", "setAppBuildNumber", "setAppVersionCode", "setApiUrl", "setFrameUrl", "isOpened", "open", "close", "on", "setLanguage", "setOfflineMode", "initialize", "disableConsoleLogOverwrite", "logEvent", "hide", "enableShortcuts", "showFeedbackButton", "destroy", "getIdentity", "isUserIdentified", "clearIdentity", "openConversations", "openConversation", "openHelpCenterCollection", "openHelpCenterArticle", "openHelpCenter", "searchHelpCenter", "openNewsArticle", "openChecklists", "startChecklist", "openNews", "openFeatureRequests", "isLiveMode"], Gleap.f = function (e) { return function () { var t = Array.prototype.slice.call(arguments); window.GleapActions.push({ e: e, a: t }) } }, t = 0; t < Gleap.methods.length; t++)Gleap[i = Gleap.methods[t]] = Gleap.f(i); Gleap.load = function () { var t = document.getElementsByTagName("head")[0], i = document.createElement("script"); i.type = "text/javascript", i.async = !0, i.src = "https://sdk.gleap.io/latest/index.js", t.appendChild(i) }, Gleap.load(),
                    Gleap.initialize("utFIO0sh3olA4zAWGNgy6C7x0dCiyNIc")
            }
        }();
    </script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* list little space at the bottom */
        li {
            margin-bottom: 5px;
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <h1 class="mb-4">Spotify Downloader</h1>
        <form id="search-form">
            <div class="form-group">
                <label for="search_query">Search for a song or URL</label>
                <input type="text" class="form-control" id="search_query" placeholder="Enter a song or URL">
            </div>
            <div class="form-row">
                <div class="form-group col-md-4">
                    <label for="audio_format">Audio provider</label>
                    <select class="form-control" id="audio_format">
                        <option value="youtube">YouTube</option>
                        <option value="youtube-music">YouTube Music</option>
                        <option value="slider-kz">slider.kz</option>
                        <option value="soundcloud">SoundCloud</option>
                        <option value="bandcamp">Bandcamp</option>
                        <option value="piped">Piped</option>
                    </select>
                </div>
                <div class="form-group col-md-4">
                    <label for="lyrics_format">Lyrics provider</label>
                    <select class="form-control" id="lyrics_format">
                        <option value="musixmatch">musixmatch</option>
                        <option value="genius">genius</option>
                        <option value="azlyrics">azlyrics</option>
                        <option value="synced">synced</option>
                        <option value="">NONE</option>
                    </select>
                </div>
                <div class="form-group col-md-4">
                    <label for="output_format">Output format</label>
                    <select class="form-control" id="output_format">
                        <option value="mp3">MP3</option>
                        <option value="m4a">M4A</option>
                        <option value="wav">WAV</option>
                        <option value="flac">FLAC</option>
                        <option value="ogg">OGG</option>
                        <option value="opus">OPUS</option>
                    </select>
                </div>
                <div class="form-group col-md-4">
                    <button type="button" class="btn btn-primary" id="download-button">Search</button>
                </div>
            </div>
        </form>

        <div class="mt-3">
            <h2>Requests</h2>
            <ul id="requests-list">
                <!-- Requests will be added here dynamically -->
            </ul>
        </div>
        <br>
        <div>
            <h3>FAQ</h3>
            <p><b>Q: How do I download songs?</b></p>
            <p>A: Enter a song title or URL and press Search. Once the song is found, click Download.</p>
            <p><b>Q: How do I download playlists?</b></p>
            <p>A: You can download playlists by entering a playlist URL. The playlist must be public.</p>
            <p><b>What are Audio Providers?</b></p>
            <p>Audio Providers are the sources, where the audio is downloaded from (it is not directly downloaded from
                Spotify).</p>
            <p><b>What are Lyrics Providers?</b></p>
            <p>Lyrics Providers are the sources, where the lyrics are downloaded from. If you don't want lyrics, select
                NONE.</p>
            <p><b>What are Output Formats?</b></p>
            <p>Output Formats are the formats, the audio is converted to. If you don't know what to choose, select MP3.
            </p>
            <p><b>Q: Why has my download an error.txt file inside?</b></p>
            <p>This is, because an error occured, when trying to download this song. It propably is not available. Try
                using another Audio Provider</p>
            <p><b>Q: Why is my download pending?</b></p>
            <p>This is because the song is currently being downloaded. Please wait a few minutes. If you are searching
                for a playlist, the process can easily take up to 10-20 minutes.</p>
            <br>
            <h3>Disclaimer</h3>
            <p>This Spotify downloader is legal for personal use only. The music may not be distributed or played in
                public.</p>
        </div>
    </div>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            var requestElements = {};
            var requestIdCounter = 0;

            async function initiateDownload() {
                var search_query = $("#search_query").val();
                var audio_format = $("#audio_format").val();
                var lyrics_format = $("#lyrics_format").val();
                var output_format = $("#output_format").val();

                if (!(search_query.trim() === '' || audio_format.trim() === '' || lyrics_format.trim() === '' || output_format.trim() === '')) {
                    if (search_query.includes("https://open.spotify.com/playlist/")) {
                        if (getCookie("playlistNotification") == "") {
                            const { value: accept } = await Swal.fire({
                                title: 'Info...',
                                color: 'black',
                                icon: 'info',
                                text: 'Downloading a playlist can take a few minutes.',
                                input: 'checkbox',
                                inputValue: 0,
                                inputPlaceholder: 'Do not show again',
                                confirmButtonText: 'OK',
                            })
                            if (accept) {
                                setCookie("playlistNotification", true, 365);
                            }
                        }
                    } else if (!search_query.includes("https://open.spotify.com/track/")) {
                        if (getCookie("trackNotification") == "") {
                            const { value: accept } = await Swal.fire({
                                title: 'Info...',
                                color: 'black',
                                icon: 'info',
                                text: 'Search queries are often very imprecise. Please use links if you want to get accurate results.',
                                input: 'checkbox',
                                inputValue: 0,
                                inputPlaceholder: 'Do not show again',
                                confirmButtonText: 'OK',
                            })
                            if (accept) {
                                setCookie("trackNotification", true, 365);
                            }
                        }
                    }
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Please provide a search query or link!',
                    })
                    return;
                }

                
                var requestId = 'request_' + (requestIdCounter++);
                var requestItem = '<li id="' + requestId + '"><span>' + search_query + ' (Pending)</span> <div class="spinner-border text-primary" role="status"><span class="sr-only">Loading...</span></div></li>';
                $("#requests-list").append(requestItem);

                $.post('/search', {
                    search_query: search_query,
                    audio_format: audio_format,
                    lyrics_format: lyrics_format,
                    output_format: output_format
                }, function (data) {
                    if (data.status === 'completed') {
                        var requestElement = $('#' + requestId);
                        requestElement.find('span').text(search_query + ' (' + data.status + ')');
                        var downloadButton = '<a class="btn btn-success" target="_blank" href="/download/' + data.unique_id + '">Download</a>';
                        requestElement.append(downloadButton);
                    } else {
                        function checkStatus(uuid, unique_id) {
                            var requestElement = $('#' + uuid);
                            var downloadButtonExists = requestElement.find('.btn-success').length > 0;

                            if (downloadButtonExists) {
                                requestElement.find('.spinner-border').remove();
                                clearInterval(requestElements[uuid]);
                            } else {
                                $.get('/status/' + unique_id, function (data) {
                                    if (data.status === 'completed') {
                                        requestElement.find('span').text(search_query + ' (' + data.status + ')');
                                        var downloadButton = '<a class="btn btn-success" target="_blank" href="/download/' + unique_id + '">Download</a>';
                                        requestElement.append(downloadButton);
                                        requestElement.find('.spinner-border').remove();
                                        clearInterval(requestElements[uuid]);
                                    }
                                });
                            }
                        }

                        requestElements[requestId] = setInterval(function () {
                            checkStatus(requestId, data.unique_id);
                        }, 10000);
                    }
                });
            }

            $("#search-form").submit(function (event) {
                event.preventDefault();
                initiateDownload();
                // clear input
                $("#search_query").val('');
            });

            $("#download-button").click(function () {
                initiateDownload();
                // clear input
                $("#search_query").val('');
            });

            $("#search_query").keypress(function (e) {
                if (e.which === 13) {
                    e.preventDefault();
                    initiateDownload();
                    // clear input
                    $("#search_query").val('');
                }
            });
        });
    </script>
    <script>
        function setCookie(cname, cvalue, exdays) {
            const d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            let expires = "expires=" + d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }

        function getCookie(cname) {
            const name = cname + "=";
            const decodedCookie = decodeURIComponent(document.cookie);
            const ca = decodedCookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function checkCookie() {
            let user = getCookie("username");
            if (user != "") {
                alert("Welcome again " + user);
            } else {
                user = prompt("Please enter your name:", "");
                if (user != "" && user != null) {
                    setCookie("username", user, 365);
                }
            }
        }

        function eraseCookie(name) {
            document.cookie = name + '=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
        }
    </script>
</body>

</html>